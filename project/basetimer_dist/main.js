(()=>{"use strict";var t={d:(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};(()=>{let t=0;const e=document.documentElement.style,n=document.getElementById("skyLayer"),a=document.getElementById("clockT"),s=document.getElementById("timeRange"),o=document.getElementById("autoCheck"),r=document.getElementById("perfToggle");let i="true"===localStorage.getItem("qpi_perf_mode_v2"),c=-1;const l={"h-1":document.getElementById("h-1"),"r-1":document.getElementById("r-1"),"g-1":document.getElementById("g-1"),"g-2":document.getElementById("g-2"),"t-1":document.getElementById("t-1"),"mg-1":document.getElementById("mg-1"),"mh-1":document.getElementById("mh-1"),sunFC:document.getElementById("sunFlareCont"),moonFC:document.getElementById("moonFlareCont")};r.checked=i,i&&document.body.classList.add("perf-active"),r.onchange=t=>{i=t.target.checked,localStorage.setItem("qpi_perf_mode_v2",i),i?document.body.classList.add("perf-active"):document.body.classList.remove("perf-active")};let u=720,d=performance.now(),h=1,f=!1,m=0,g=0,b=0,p=null,y="";function v(t){const e=t.toDateString();if(p&&y===e)return p;const n=Math.floor((t-new Date(t.getFullYear(),0,0))/864e5),a=Math.PI/180,s=2*Math.PI/365*(n-1),o=229.18*(75e-6+.001868*Math.cos(s)-.032077*Math.sin(s)-.014615*Math.cos(2*s)-.040849*Math.sin(2*s)),r=.006918-.399912*Math.cos(s)+.070257*Math.sin(s),i=Math.acos(Math.cos(90.833*a)/(Math.cos(36.5*a)*Math.cos(r))-Math.tan(36.5*a)*Math.tan(r))/a;return y=e,p={sunrise:720-4*(127.2+i)-o+540,sunset:720-4*(127.2-i)-o+540},p}const M=document.getElementById("starCanvas"),k=M.getContext("2d");function w(t,e,n,a=!1){const s=a?l.moonFC:l.sunFC,o=(n-0)/.3,r=Math.max(0,Math.min(1,o)),i=a?.4:.95;if(s.style.opacity=r*i,r<=0)return;const c=50-t,u=50-e,d=(n,a)=>{const s=l[n];s&&(s.style.transform=`translate(-50%, -50%) translate(${t+c*a}vw, ${e+u*a}vh)`)};a?(d("mg-1",1.2),d("mh-1",.5)):(d("h-1",.5),d("r-1",1.3),d("g-1",1.6),d("g-2",1.1),d("t-1",.25))}!function(){let t=277;const e=()=>(t=(1664525*t+1013904223)%4294967296,t/4294967296);M.width=4e3,M.height=4e3,k.fillStyle="#fff";for(let t=0;t<8e3;t++)k.globalAlpha=Math.random(),k.beginPath(),k.arc(4e3*e(),4e3*e(),1.3*e()+.3,0,2*Math.PI),k.fill();k.globalAlpha=1,k.beginPath(),k.arc(2e3,2e3,1.6,0,2*Math.PI),k.fill()}();let S="",x="";function j(s){const o=(s%1440+1440)%1440,r=v(new Date),i=r.sunrise-135,c=r.sunset-135,u=r.sunset+30,d=[{m:-1440,z:[5,10,25],hz:[10,20,35]},{m:i,z:[5,10,25],hz:[10,20,35]},{m:r.sunrise,z:[40,80,140],hz:[255,150,100]},{m:(r.sunrise+r.sunset)/2,z:[25,90,180],hz:[180,230,255]},{m:c,z:[25,90,180],hz:[180,230,255]},{m:r.sunset,z:[20,30,80],hz:[245,125,75]},{m:r.sunset+15,z:[10,15,40],hz:[60,30,60]},{m:u,z:[5,10,25],hz:[10,20,35]},{m:1440,z:[5,10,25],hz:[10,20,35]}];let h="rgb(5, 10, 25)",f="rgb(10, 20, 35)",m=15;for(let e=0;e<d.length-1;e++)if(o>=d[e].m&&o<d[e+1].m){const n=(o-d[e].m)/(d[e+1].m-d[e].m),a=(t,e)=>t+(e-t)*n,s=Math.round(a(d[e].hz[0],d[e+1].hz[0])),r=Math.round(a(d[e].hz[1],d[e+1].hz[1])),i=Math.round(a(d[e].hz[2],d[e+1].hz[2]));h=`rgb(${Math.round(a(d[e].z[0],d[e+1].z[0]))}, ${Math.round(a(d[e].z[1],d[e+1].z[1]))}, ${Math.round(a(d[e].z[2],d[e+1].z[2]))})`,f=`rgb(${s}, ${r}, ${i})`,t&&(h=`oklch(from ${h} l c calc(h + ${t}))`,f=`oklch(from ${f} l c calc(h + ${t}))`),m=(s+r+i)/3;break}let g=Math.min(1,Math.max(0,(m-22)/200));g<.5&&(g*=.5),g>.5&&(g=.5*g+.5);const b=[235,245,255,.45,0,20,40,0,20,50,0,122,255,250,250,250,55,.2,235,245,255,.16],p=[20,25,35,.65,255,255,255,255,255,255,144,202,249,0,51,84,255,.1,255,255,255,.08].map((t,e)=>t*(1-g)+b[e]*g);if(e.setProperty("--glass-bg",`rgba(${p[0]}, ${p[1]}, ${p[2]}, ${p[3]})`),e.setProperty("--text-main",`rgb(${p[4]}, ${p[5]}, ${p[6]})`),e.setProperty("--text-sub",`rgba(${p[7]}, ${p[8]}, ${p[9]}, 0.7)`),t?(e.setProperty("--primary",`oklch(from rgb(${p[10]}, ${p[11]}, ${p[12]}) l c calc(h + ${t}))`),e.setProperty("--on-primary-container",`oklch(from rgb(${p[13]}, ${p[14]}, ${p[15]}) l c calc(h + ${t}))`)):(e.setProperty("--primary",`rgb(${p[10]}, ${p[11]}, ${p[12]})`),e.setProperty("--on-primary-container",`rgb(${p[13]}, ${p[14]}, ${p[15]})`)),e.setProperty("--glass-border",`rgba(${p[16]}, ${p[16]}, ${p[16]}, ${p[17]})`),e.setProperty("--glass-stack",`rgba(${p[18]}, ${p[19]}, ${p[20]}, ${p[21]})`),e.setProperty("--chip-bg",`rgba(${p[16]}, ${p[16]}, ${p[16]}, 0.1)`),h===S&&f===x||(n.style.background=`linear-gradient(to bottom, ${h} 0%, ${f} 100%)`,S=h,x=f),o>=r.sunrise-20&&o<=r.sunset+20){const t=(o-r.sunrise)/(r.sunset-r.sunrise),n=Math.sin(t*Math.PI),a=120*t-10,s=100-90*n;e.setProperty("--sun-x",a+"vw"),e.setProperty("--sun-y",s+"vh"),e.setProperty("--atm-opacity",Math.max(0,Math.min(.85,1.2*n))),w(a,s,n,!1)}else e.setProperty("--sun-y","150vh"),e.setProperty("--atm-opacity",0),l.sunFC.style.opacity=0;const y=(o+720)%1440;if(y>=r.sunrise-140&&y<=r.sunset+140){const t=(y-(r.sunrise-120))/(r.sunset+120-(r.sunrise-120)),n=Math.sin(t*Math.PI),a=120*t-10,s=100-90*n;e.setProperty("--moon-x",a+"vw"),e.setProperty("--moon-y",s+"vh"),w(a,s,n,!0)}else e.setProperty("--moon-y","150vh"),l.moonFC.style.opacity=0;let M=0,k=-50;o>=r.sunset-180&&o<=r.sunset+30?(M=(o-(r.sunset-180))/210,k=200*M-50):o>=r.sunrise-60&&o<=r.sunrise+180?(M=1-(o-(r.sunrise-60))/240,k=150-200*(1-M)):(o>r.sunset+30||o<r.sunrise-60)&&(M=1,k=150),e.setProperty("--star-opacity",Math.max(0,Math.min(1,M))),e.setProperty("--star-mask-y",k+"%"),e.setProperty("--star-rot",o/4+"deg");const j=Math.floor(o/60),T=Math.floor(o%60),_=Math.round(60*o%60),C=`${j.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`;a.textContent=C}function T(t){h=(h*t>0?1:-1)*Math.max(.5,Math.min(1024,Math.abs(h*t))),document.getElementById("speedVal").textContent=h}function _(t){const e=(t+1440)%1440;return`${Math.floor(e/60).toString().padStart(2,"0")}:${Math.floor(e%60).toString().padStart(2,"0")}`}document.getElementById("autoCheck").addEventListener("change",function(){if(o.checked)f=!0,g=performance.now(),m=u,b=t,document.getElementById("manualSection").classList.add("disabled");else{f=!1,document.getElementById("manualSection").classList.remove("disabled");const t=new Date;u=60*t.getHours()+t.getMinutes()+t.getSeconds()/60}}),document.getElementById("manualSlower").addEventListener("click",()=>T(.5)),document.getElementById("manualFaster").addEventListener("click",()=>T(2)),document.getElementById("manualReverse").addEventListener("click",()=>T(-1)),document.getElementById("clock").addEventListener("click",function(){const t=v(new Date);document.getElementById("infoRise").textContent=_(t.sunrise),document.getElementById("infoSet").textContent=_(t.sunset),document.getElementById("infoDate").textContent=(new Date).toLocaleDateString("ko-KR",{month:"short",day:"numeric",weekday:"short"})}),s.oninput=function(){o.checked||(u=parseFloat(this.value),j(u))},document.getElementById("multiverseRange").oninput=function(){o.checked||(t=parseFloat(this.value),j(u))},requestAnimationFrame(function e(n){const r=n-d;let l;d=n,c++;const p=new Date,y=60*p.getHours()+p.getMinutes()+p.getSeconds()/60;if(o.checked)if(f){let e=Math.min((n-g)/2e3,1),a=e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,s=(y-m+1440)%1440;s>720&&(s-=1440);let o=(0-b+360)%360;o>180&&(o-=360),l=m+s*a,e>=1&&(f=!1),u=l,t=b+o*a}else l=y,u=l;else u+=r/6e4*h,l=u;const v=(l%1440+1440)%1440;s.value=v,document.getElementById("multiverseRange").value=t;const M=Math.floor(v/60),k=Math.floor(v%60),w=Math.round(60*v%60);if(a.textContent=`${M.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`,requestAnimationFrame(e),i)if(f||!o.checked&&Math.abs(h)>2){if(c%2!=0)return}else if(c%30!=0)return;j(l)});const C=document.getElementById("satLayer");function E(t=!1){const e=v(new Date),n=(u%1440+1440)%1440;let a=-1;if(n>=e.sunrise&&n<=e.sunset){const t=(n-e.sunrise)/(e.sunset-e.sunrise);a=Math.sin(t*Math.PI)}if(a>.05)return;const s=Math.floor(4*Math.random());let r,c,l,d;0===s?(r=-15,c=100*Math.random(),l=115,d=100*Math.random()):1===s?(r=115,c=100*Math.random(),l=-15,d=100*Math.random()):2===s?(r=100*Math.random(),c=-15,l=100*Math.random(),d=115):(r=100*Math.random(),c=115,l=100*Math.random(),d=-15);const f=(2e4*Math.random()+4e4)/(o.checked?1:Math.min(Math.abs(h),256)),m=t?i?8:18:1;for(let e=0;e<m;e++){const n=t?e*(700+400*Math.random())/(o.checked?1:Math.min(Math.abs(h),256)):0;setTimeout(()=>{const t=document.createElement("div");t.className="satellite",t.style.opacity=.5*Math.random()+.3,C.appendChild(t);const e=performance.now(),n=a=>{const s=(a-e)/f;s<1?(t.style.transform=`translate(${r+(l-r)*s}vw, ${c+(d-c)*s}vh)`,requestAnimationFrame(n)):t.remove()};requestAnimationFrame(n)},n)}}setTimeout(()=>{const t=()=>{E(!1),setTimeout(t,(6e4*Math.random()+4e4)/(o.checked?1:Math.abs(h)))},e=()=>{E(!0),setTimeout(e,(12e4*Math.random()+12e4)/(o.checked?1:Math.abs(h)))};t(),e()},5e3);let L=new(window.AudioContext||window.webkitAudioContext),B=L.createGain();B.connect(L.destination),B.gain.value=.25;const $=["./sound/crickets.mp3","./sound/creepy_tomb.mp3","./sound/so_ambient.mp3"];let A=[];for(let t of $)A.push(async()=>{try{return L.decodeAudioData(await(await fetch(t)).arrayBuffer())}catch{return null}});let I=-1,D=null;async function H(t){if(I!==t){if(-1!==I)try{D.stop(),D.disconnect()}catch{}if(I=t,-1!==t&&A&&A[t]){A[t]instanceof Function&&(A[t]=await A[t]());try{const e=new AudioBufferSourceNode(L,{buffer:A[t],loop:!0});e.connect(B),e.start(),D=e}catch{}}}}Array.from(document.getElementsByClassName("soundToggle")).forEach(t=>{t.onchange=function(){this.checked?(Array.from(document.getElementsByClassName("soundToggle")).forEach(t=>{t.checked=!1}),this.checked=!0,H(t.value)):H(-1)}}),document.getElementById("volumeRange").oninput=t=>{B&&(B.gain.value=(t.target.value/100)**2)};const F=document.getElementById("vizCanvas"),P=F.getContext("2d");let R,N,z=!1,O=48e3,q=[];function G(){if(!z)return;requestAnimationFrame(G),R.getByteFrequencyData(N),F.width=window.innerWidth,F.height=200,P.clearRect(0,0,F.width,F.height);const t=F.width/80,e=O/2,n=getComputedStyle(document.documentElement).getPropertyValue("--text-main").trim();for(let a=0;a<80;a++){const s=80*Math.pow(175,a/79),o=Math.floor(s/e*N.length);let r=N[o]||0,i=r/255*F.height*(.6+a/80*.5);q[a]||(q[a]=0),i>q[a]?q[a]=i:q[a]*=.94;const c=Math.min(q[a],.8*F.height);P.fillStyle=n.replace("rgb","rgba").replace(")",`, ${Math.max(.08,r/255*.4)})`),P.fillRect(a*t,F.height-c,t-1,c)}}document.getElementById("btnViz").onclick=async()=>{try{let t=null;try{t=await navigator.mediaDevices.getDisplayMedia({audio:!0})}catch{alert("오디오 출력을 캡처할 수 없어 기기 마이크를 사용합니다."),t=await navigator.mediaDevices.getUserMedia({audio:!0})}const e=new AudioContext;O=e.sampleRate;const n=e.createMediaStreamSource(t);R=e.createAnalyser(),n.connect(R),R.fftSize=1024,R.smoothingTimeConstant=.92,N=new Uint8Array(R.frequencyBinCount),z=!0,G()}catch(t){alert(`Capture failed.\n${t}`)}}})(),(()=>{t.d(e,{AU:()=>$t,ky:()=>At});const n="ypt_local_v2",a=(()=>{const t=()=>({version:2,subjects:[],settings:{dailyGoalMs:72e5,lastSubjectId:"",viewMode:"total",panelTab:"stats",statsPeriod:"today",calendarMonthTs:f(Date.now())},days:{},meta:{bestFocusMs:0}});function e(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch{return null}}function a(t){localStorage.setItem(n,JSON.stringify(t))}return{load:function(){return function(e){const n=t();if(!e||"object"!=typeof e)return n;2!==e.version&&(e.version=2),e.subjects=Array.isArray(e.subjects)?e.subjects:[],e.settings={...n.settings,...e.settings||{}},e.days=e.days&&"object"==typeof e.days?e.days:{},e.meta={...n.meta,...e.meta||{}},e.subjects=e.subjects.map(t=>({id:t.id||uid("s"),name:(t.name||"과목").slice(0,24),color:t.color||"#90caf9",createdAt:t.createdAt||Date.now()}));for(const t of Object.keys(e.days)){const n=e.days[t];n&&"object"==typeof n&&("number"!=typeof n.totalMs&&(n.totalMs=0),n.subjects&&"object"==typeof n.subjects||(n.subjects={}),Array.isArray(n.sessions)||(n.sessions=[]),"number"!=typeof n.longestFocusMs&&(n.longestFocusMs=0))}return e}(function(){const s=e(n);if(s)return s;const o=e("studyTracker_v1");if(!o)return null;const r=t();try{const t=["#90caf9","#a5d6a7","#f48fb1","#ffcc80","#ce93d8","#80cbc4","#fff59d","#b0bec5"];r.subjects=(o.subjects||[]).map((e,n)=>({id:e.id||uid("s"),name:e.name||"과목",color:t[n%t.length],createdAt:Date.now()})),r.settings.viewMode="subject"===o.meta?.mode?"subject":"total",r.settings.lastSubjectId=o.meta?.selectedSubjectId||"";const e=o.days||{};for(const t of Object.keys(e)){const n=e[t]||{},a={};for(const t of Object.keys(n.subjectSeconds||{}))a[t]=Math.round(1e3*(n.subjectSeconds[t]||0));r.days[t]={totalMs:Math.round(1e3*(n.totalSeconds||0)),subjects:a,sessions:[],longestFocusMs:0}}return a(r),r}catch{return null}}()||e(n)||t())},save:a,defaultStore:t}})(),s={store:a.load(),save:()=>a.save(s.store),reset:()=>{s.store=a.defaultStore(),s.save()},runtime:{running:!1,lastTs:0,activeSubjectId:"",sessionStartTs:0,sessionSubjectId:"",focusStartTs:0,rafId:0,lastUiTs:0,lastSaveTs:0,panelOpen:!1}};window.appdump=()=>{console.log("store:"),console.log(s.store),console.log("runtime:"),console.log(s.runtime)};let o=localStorage.getItem("ypt_user_name");async function r(t){const e=e(t),n=s.store.days[e];if(!n||n.totalMs<=0)return;const a={date:e,userName:o,totalMs:n.totalMs,formattedTime:u(n.totalMs)};try{(await fetch("https://script.google.com/macros/s/AKfycbzh4V2v2v4mzSkQQkf49FrRjRb3pCsnx4I0T4QBgC4CA8YA9JaRJmgOYee9Tq6hCrq-/exec",{method:"POST",body:JSON.stringify(a)})).ok&&(console.log(`${e} 데이터 전송 성공: ${o}`),localStorage.setItem(`synced_${e}`,"true"))}catch(t){console.error("전송 오류:",t)}}o||(o=prompt("학번_이름을 입력해주세요"),o||(o="익명"),localStorage.setItem("ypt_user_name",o));const i=t=>String(t).padStart(2,"0"),c=(t,e,n)=>Math.max(e,Math.min(n,t)),l=t=>String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");function u(t){const e=Math.max(0,Math.floor(t/1e3)),n=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%60;return`${i(n)}:${i(a)}:${i(s)}`}function d(t){const e=void 0!==t?new Date(t):new Date;return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())}`}function h(t){const e=new Date(t);return e.setHours(0,0,0,0),e.getTime()}function f(t){const e=new Date(t);return e.setDate(1),e.setHours(0,0,0,0),e.getTime()}function m(t){return h(t)+864e5}function g(t){const e=new Date(t),n=e.getDay(),a=0===n?-6:1-n;return e.setDate(e.getDate()+a),e.setHours(0,0,0,0),e.getTime()}function b(t,e){if(e.target!==t)return!1;const n=t.getBoundingClientRect();return!(n.top<=event.clientY&&event.clientY<=n.top+n.height&&n.left<=event.clientX&&event.clientX<=n.left+n.width)}function p(t){return s.store.days[t]||(s.store.days[t]={totalMs:0,subjects:{},sessions:[],longestFocusMs:0}),s.store.days[t]}function y(t){return s.store.subjects.find(e=>e.id===t)||null}function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}var M=/^\s+/,k=/\s+$/;function w(t,e){if(e=e||{},(t=t||"")instanceof w)return t;if(!(this instanceof w))return new w(t,e);var n=function(t){var e,n,a,s={r:0,g:0,b:0},o=1,r=null,i=null,c=null,l=!1,u=!1;return"string"==typeof t&&(t=function(t){t=t.replace(M,"").replace(k,"").toLowerCase();var e,n=!1;if(R[t])t=R[t],n=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=X.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=X.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=X.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=X.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=X.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=X.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=X.hex8.exec(t))?{r:G(e[1]),g:G(e[2]),b:G(e[3]),a:Y(e[4]),format:n?"name":"hex8"}:(e=X.hex6.exec(t))?{r:G(e[1]),g:G(e[2]),b:G(e[3]),format:n?"name":"hex"}:(e=X.hex4.exec(t))?{r:G(e[1]+""+e[1]),g:G(e[2]+""+e[2]),b:G(e[3]+""+e[3]),a:Y(e[4]+""+e[4]),format:n?"name":"hex8"}:!!(e=X.hex3.exec(t))&&{r:G(e[1]+""+e[1]),g:G(e[2]+""+e[2]),b:G(e[3]+""+e[3]),format:n?"name":"hex"}}(t)),"object"==v(t)&&(K(t.r)&&K(t.g)&&K(t.b)?(e=t.r,n=t.g,a=t.b,s={r:255*O(e,255),g:255*O(n,255),b:255*O(a,255)},l=!0,u="%"===String(t.r).substr(-1)?"prgb":"rgb"):K(t.h)&&K(t.s)&&K(t.v)?(r=W(t.s),i=W(t.v),s=function(t,e,n){t=6*O(t,360),e=O(e,100),n=O(n,100);var a=Math.floor(t),s=t-a,o=n*(1-e),r=n*(1-s*e),i=n*(1-(1-s)*e),c=a%6;return{r:255*[n,r,o,o,i,n][c],g:255*[i,n,n,r,o,o][c],b:255*[o,o,i,n,n,r][c]}}(t.h,r,i),l=!0,u="hsv"):K(t.h)&&K(t.s)&&K(t.l)&&(r=W(t.s),c=W(t.l),s=function(t,e,n){var a,s,o;function r(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}if(t=O(t,360),e=O(e,100),n=O(n,100),0===e)a=s=o=n;else{var i=n<.5?n*(1+e):n+e-n*e,c=2*n-i;a=r(c,i,t+1/3),s=r(c,i,t),o=r(c,i,t-1/3)}return{r:255*a,g:255*s,b:255*o}}(t.h,r,c),l=!0,u="hsl"),t.hasOwnProperty("a")&&(o=t.a)),o=z(o),{ok:l,format:t.format||u,r:Math.min(255,Math.max(s.r,0)),g:Math.min(255,Math.max(s.g,0)),b:Math.min(255,Math.max(s.b,0)),a:o}}(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function S(t,e,n){t=O(t,255),e=O(e,255),n=O(n,255);var a,s,o=Math.max(t,e,n),r=Math.min(t,e,n),i=(o+r)/2;if(o==r)a=s=0;else{var c=o-r;switch(s=i>.5?c/(2-o-r):c/(o+r),o){case t:a=(e-n)/c+(e<n?6:0);break;case e:a=(n-t)/c+2;break;case n:a=(t-e)/c+4}a/=6}return{h:a,s,l:i}}function x(t,e,n){t=O(t,255),e=O(e,255),n=O(n,255);var a,s,o=Math.max(t,e,n),r=Math.min(t,e,n),i=o,c=o-r;if(s=0===o?0:c/o,o==r)a=0;else{switch(o){case t:a=(e-n)/c+(e<n?6:0);break;case e:a=(n-t)/c+2;break;case n:a=(t-e)/c+4}a/=6}return{h:a,s,v:i}}function j(t,e,n,a){var s=[U(Math.round(t).toString(16)),U(Math.round(e).toString(16)),U(Math.round(n).toString(16))];return a&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function T(t,e,n,a){return[U(V(a)),U(Math.round(t).toString(16)),U(Math.round(e).toString(16)),U(Math.round(n).toString(16))].join("")}function _(t,e){e=0===e?0:e||10;var n=w(t).toHsl();return n.s-=e/100,n.s=q(n.s),w(n)}function C(t,e){e=0===e?0:e||10;var n=w(t).toHsl();return n.s+=e/100,n.s=q(n.s),w(n)}function E(t){return w(t).desaturate(100)}function L(t,e){e=0===e?0:e||10;var n=w(t).toHsl();return n.l+=e/100,n.l=q(n.l),w(n)}function B(t,e){e=0===e?0:e||10;var n=w(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),w(n)}function $(t,e){e=0===e?0:e||10;var n=w(t).toHsl();return n.l-=e/100,n.l=q(n.l),w(n)}function A(t,e){var n=w(t).toHsl(),a=(n.h+e)%360;return n.h=a<0?360+a:a,w(n)}function I(t){var e=w(t).toHsl();return e.h=(e.h+180)%360,w(e)}function D(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=w(t).toHsl(),a=[w(t)],s=360/e,o=1;o<e;o++)a.push(w({h:(n.h+o*s)%360,s:n.s,l:n.l}));return a}function H(t){var e=w(t).toHsl(),n=e.h;return[w(t),w({h:(n+72)%360,s:e.s,l:e.l}),w({h:(n+216)%360,s:e.s,l:e.l})]}function F(t,e,n){e=e||6,n=n||30;var a=w(t).toHsl(),s=360/n,o=[w(t)];for(a.h=(a.h-(s*e>>1)+720)%360;--e;)a.h=(a.h+s)%360,o.push(w(a));return o}function P(t,e){e=e||6;for(var n=w(t).toHsv(),a=n.h,s=n.s,o=n.v,r=[],i=1/e;e--;)r.push(w({h:a,s,v:o})),o=(o+i)%1;return r}w.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,e,n,a=this.toRgb();return t=a.r/255,e=a.g/255,n=a.b/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(t){return this._a=z(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=x(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=x(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),a=Math.round(100*t.v);return 1==this._a?"hsv("+e+", "+n+"%, "+a+"%)":"hsva("+e+", "+n+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var t=S(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=S(this._r,this._g,this._b),e=Math.round(360*t.h),n=Math.round(100*t.s),a=Math.round(100*t.l);return 1==this._a?"hsl("+e+", "+n+"%, "+a+"%)":"hsla("+e+", "+n+"%, "+a+"%, "+this._roundA+")"},toHex:function(t){return j(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return function(t,e,n,a,s){var o=[U(Math.round(t).toString(16)),U(Math.round(e).toString(16)),U(Math.round(n).toString(16)),U(V(a))];return s&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*O(this._r,255))+"%",g:Math.round(100*O(this._g,255))+"%",b:Math.round(100*O(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*O(this._r,255))+"%, "+Math.round(100*O(this._g,255))+"%, "+Math.round(100*O(this._b,255))+"%)":"rgba("+Math.round(100*O(this._r,255))+"%, "+Math.round(100*O(this._g,255))+"%, "+Math.round(100*O(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(N[j(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var e="#"+T(this._r,this._g,this._b,this._a),n=e,a=this._gradientType?"GradientType = 1, ":"";if(t){var s=w(t);n="#"+T(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+e+",endColorstr="+n+")"},toString:function(t){var e=!!t;t=t||this._format;var n=!1,a=this._a<1&&this._a>=0;return e||!a||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return w(this.toString())},_applyModification:function(t,e){var n=t.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(L,arguments)},brighten:function(){return this._applyModification(B,arguments)},darken:function(){return this._applyModification($,arguments)},desaturate:function(){return this._applyModification(_,arguments)},saturate:function(){return this._applyModification(C,arguments)},greyscale:function(){return this._applyModification(E,arguments)},spin:function(){return this._applyModification(A,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(F,arguments)},complement:function(){return this._applyCombination(I,arguments)},monochromatic:function(){return this._applyCombination(P,arguments)},splitcomplement:function(){return this._applyCombination(H,arguments)},triad:function(){return this._applyCombination(D,[3])},tetrad:function(){return this._applyCombination(D,[4])}},w.fromRatio=function(t,e){if("object"==v(t)){var n={};for(var a in t)t.hasOwnProperty(a)&&(n[a]="a"===a?t[a]:W(t[a]));t=n}return w(t,e)},w.equals=function(t,e){return!(!t||!e)&&w(t).toRgbString()==w(e).toRgbString()},w.random=function(){return w.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},w.mix=function(t,e,n){n=0===n?0:n||50;var a=w(t).toRgb(),s=w(e).toRgb(),o=n/100;return w({r:(s.r-a.r)*o+a.r,g:(s.g-a.g)*o+a.g,b:(s.b-a.b)*o+a.b,a:(s.a-a.a)*o+a.a})},w.readability=function(t,e){var n=w(t),a=w(e);return(Math.max(n.getLuminance(),a.getLuminance())+.05)/(Math.min(n.getLuminance(),a.getLuminance())+.05)},w.isReadable=function(t,e,n){var a,s,o,r,i,c=w.readability(t,e);switch(s=!1,(o=n,"AA"!==(r=((o=o||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==r&&(r="AA"),"small"!==(i=(o.size||"small").toLowerCase())&&"large"!==i&&(i="small"),a={level:r,size:i}).level+a.size){case"AAsmall":case"AAAlarge":s=c>=4.5;break;case"AAlarge":s=c>=3;break;case"AAAsmall":s=c>=7}return s},w.mostReadable=function(t,e,n){var a,s,o,r,i=null,c=0;s=(n=n||{}).includeFallbackColors,o=n.level,r=n.size;for(var l=0;l<e.length;l++)(a=w.readability(t,e[l]))>c&&(c=a,i=w(e[l]));return w.isReadable(t,i,{level:o,size:r})||!s?i:(n.includeFallbackColors=!1,w.mostReadable(t,["#fff","#000"],n))};var R=w.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},N=w.hexNames=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}(R);function z(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function O(t,e){(function(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!=t.indexOf("%")}(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function q(t){return Math.min(1,Math.max(0,t))}function G(t){return parseInt(t,16)}function U(t){return 1==t.length?"0"+t:""+t}function W(t){return t<=1&&(t=100*t+"%"),t}function V(t){return Math.round(255*parseFloat(t)).toString(16)}function Y(t){return G(t)/255}var J,Z,Q,X=(Z="[\\s|\\(]+("+(J="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+J+")[,|\\s]+("+J+")\\s*\\)?",Q="[\\s|\\(]+("+J+")[,|\\s]+("+J+")[,|\\s]+("+J+")[,|\\s]+("+J+")\\s*\\)?",{CSS_UNIT:new RegExp(J),rgb:new RegExp("rgb"+Z),rgba:new RegExp("rgba"+Q),hsl:new RegExp("hsl"+Z),hsla:new RegExp("hsla"+Q),hsv:new RegExp("hsv"+Z),hsva:new RegExp("hsva"+Q),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function K(t){return!!X.CSS_UNIT.exec(t)}let tt={};["studyHud","studyTime","goalBarFill","modeTotalBtn","modeSubjectBtn","subjectSelect","subjectChips","addSubjectBtn","studyToggleBtn","studyToggleText","studyToggleIcon","openPanelBtn","panelSheet","panelTitle","panelSubtitle","panelScroll","closePanelBtn","tabBtnStats","tabBtnCalendar","tabBtnSubjects","tabBtnGoal","tabStats","tabCalendar","tabSubjects","tabGoal","kpiToday","kpiTodaySub","kpiWeek","kpiWeekSub","kpiMonth","kpiMonthSub","periodTodayBtn","periodWeekBtn","periodMonthBtn","breakdownList","weekdayBars","focusInfo","exportBtn","resetTodayBtn","resetAllBtn","calPrevBtn","calNextBtn","calTitle","calDow","calGrid","addSubjectBtn2","subjectsManageList","goalNow","goalHours","goalMinutes","goalResetBtn","goalSaveBtn","goalProgressText","goalProgressBar","subjectModal","subjectModalTitle","subjectModalDesc","subjectNameInput","colorDots","subjectColorInput","subjectCancelBtn","subjectSaveBtn","subjectDeleteBtn","dayDetailModal","dayDetailTitle","dayDetailSub","dayDetailList","dayDetailCloseBtn","confirmModal","confirmTitle","confirmText","confirmCancelBtn","confirmOkBtn"].forEach(t=>{tt[`${t}`]=document.getElementById(t)});const et=tt;function nt(t){const e="subject"===t?"subject":"total";s.store.settings.viewMode=e,s.save(),et.modeTotalBtn.classList.toggle("active","total"===e),et.modeSubjectBtn.classList.toggle("active","subject"===e),et.subjectSelect.disabled="subject"!==e,Ct()}function at(t){const e=s.runtime,n=t||"";if((e.activeSubjectId||"")===n)return;const a=Date.now();e.running?($t(a),At(a),e.activeSubjectId=n,e.sessionStartTs=a,e.sessionSubjectId=n,e.lastTs=a):e.activeSubjectId=n,s.store.settings.lastSubjectId=n,s.save(),_t(),Ct()}function st(){const t=et.subjectChips.scrollWidth,e=et.subjectChips.clientWidth,n=et.subjectChips.scrollLeft;0===n?et.subjectChips.style.setProperty("--left-mask","black"):et.subjectChips.style.setProperty("--left-mask","transparent"),n+e>=t-1?et.subjectChips.style.setProperty("--right-mask","black"):et.subjectChips.style.setProperty("--right-mask","transparent")}function ot(){const t=s.runtime;if(t.running)return;const e=Date.now();t.running=!0,t.lastTs=e,t.focusStartTs=e,t.sessionStartTs=e,t.sessionSubjectId=t.activeSubjectId||"",it(!0)}function rt(){const t=s.runtime;if(!t.running)return;const e=Date.now();if($t(e),At(e),t.focusStartTs){const n=e-t.focusStartTs,a=p(d(e));a.longestFocusMs=Math.max(a.longestFocusMs||0,n),s.store.meta.bestFocusMs=Math.max(s.store.meta.bestFocusMs||0,n)}t.running=!1,t.lastTs=0,t.focusStartTs=0,it(!1),s.save(),Bt()}function it(t){t?(et.studyToggleBtn.classList.add("running"),et.studyToggleText.textContent="PAUSE",et.studyToggleIcon.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none">\n\t\t\t<path d="M7 5H10V19H7V5Z" fill="var(--text-main)" style="transition: fill 0.5s;"/>\n\t\t\t<path d="M14 5H17V19H14V5Z" fill="var(--text-main)" style="transition: fill 0.5s;"/>\n\t\t</svg>'):(et.studyToggleBtn.classList.remove("running"),et.studyToggleText.textContent="START",et.studyToggleIcon.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none">\n\t\t\t<path d="M8 5V19L19 12L8 5Z" fill="var(--text-main)" style="transition: fill 0.5s;"/>\n\t\t</svg>')}function ct(){et.panelSheet.classList.remove("active"),s.runtime.panelOpen=!1}function lt(){const t=et.panelScroll.scrollHeight,e=et.panelScroll.clientHeight,n=et.panelScroll.scrollTop;0!==e&&(0===n?et.panelScroll.style.setProperty("--top-mask","black"):et.panelScroll.style.setProperty("--top-mask","transparent"),n+e>=t-1?et.panelScroll.style.setProperty("--bottom-mask","black"):et.panelScroll.style.setProperty("--bottom-mask","transparent"))}function ut(t){const e=t||"stats";s.store.settings.panelTab=e,s.save();const n=[{key:"stats",btn:et.tabBtnStats,el:et.tabStats,title:"통계"},{key:"calendar",btn:et.tabBtnCalendar,el:et.tabCalendar,title:"캘린더"},{key:"subjects",btn:et.tabBtnSubjects,el:et.tabSubjects,title:"과목"},{key:"goal",btn:et.tabBtnGoal,el:et.tabGoal,title:"목표"}];n.forEach(t=>{t.btn.classList.toggle("active",t.key===e),t.el.classList.toggle("active",t.key===e)});const a=n.find(t=>t.key===e);et.panelTitle.textContent=a?a.title:"통계",Et(),lt()}function dt(t){s.store.settings.statsPeriod=t,s.save(),et.periodTodayBtn.classList.toggle("active","today"===t),et.periodWeekBtn.classList.toggle("active","week"===t),et.periodMonthBtn.classList.toggle("active","month"===t),Et()}function ht(t,e){const n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(a)}function ft(t){const e=s.store.settings.calendarMonthTs||f(Date.now()),n=new Date(e);n.setMonth(n.getMonth()+t),n.setDate(1),n.setHours(0,0,0,0),s.store.settings.calendarMonthTs=n.getTime(),s.save(),Et()}et.modeTotalBtn.addEventListener("click",()=>nt("total")),et.modeSubjectBtn.addEventListener("click",()=>nt("subject")),et.addSubjectBtn.addEventListener("click",()=>pt("add")),et.subjectSelect.addEventListener("change",()=>at(et.subjectSelect.value)),et.subjectChips.addEventListener("scroll",st),et.studyToggleBtn.addEventListener("click",function(){s.runtime.running?rt():ot()}),et.openPanelBtn.addEventListener("click",()=>function(t=null){s.runtime.panelOpen?ct():(et.panelSheet.classList.add("active"),s.runtime.panelOpen=!0,ut(t||s.store.settings.panelTab||"stats"),Et())}(s.store.settings.panelTab||"stats")),et.closePanelBtn.addEventListener("click",ct),et.panelSheet.addEventListener("transitionend",t=>{"max-height"===t.propertyName&&lt()}),et.panelScroll.addEventListener("scroll",lt),et.tabBtnStats.addEventListener("click",()=>ut("stats")),et.tabBtnCalendar.addEventListener("click",()=>ut("calendar")),et.tabBtnSubjects.addEventListener("click",()=>ut("subjects")),et.tabBtnGoal.addEventListener("click",()=>ut("goal")),et.periodTodayBtn.addEventListener("click",()=>dt("today")),et.periodWeekBtn.addEventListener("click",()=>dt("week")),et.periodMonthBtn.addEventListener("click",()=>dt("month")),et.exportBtn.addEventListener("click",function(){const t=JSON.stringify(s.store,null,2),e=`ypt_${d()}.json`;navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{et.panelSubtitle.textContent=`${d()} · JSON 복사됨`}).catch(()=>ht(t,e)):ht(t,e)}),et.resetTodayBtn.addEventListener("click",async function(){if(!await xt("오늘 초기화","오늘 공부 기록을 초기화할까요? (되돌릴 수 없음)"))return;const t=d();s.store.days[t]={totalMs:0,subjects:{},sessions:[],longestFocusMs:0},s.save(),rt(),Bt()}),et.resetAllBtn.addEventListener("click",async function(){await xt("전체 초기화","모든 공부 기록/과목/설정을 초기화할까요? (되돌릴 수 없음)")&&(s.reset(),s.runtime.running=!1,s.runtime.lastTs=0,s.runtime.activeSubjectId="",it(!1),Bt())}),et.calPrevBtn.addEventListener("click",()=>ft(-1)),et.calNextBtn.addEventListener("click",()=>ft(1)),et.addSubjectBtn2.addEventListener("click",()=>pt("add")),et.goalSaveBtn.addEventListener("click",function(){const t=6e4*(60*c(parseInt(et.goalHours.value||"0",10)||0,0,23)+c(parseInt(et.goalMinutes.value||"0",10)||0,0,59));s.store.settings.dailyGoalMs=t,s.save(),Bt()}),et.goalResetBtn.addEventListener("click",function(){s.store.settings.dailyGoalMs=72e5,s.save(),Bt()}),et.subjectModal.addEventListener("click",t=>{b(et.subjectModal,t)&&yt()}),et.subjectCancelBtn.addEventListener("click",yt),et.subjectColorInput.addEventListener("input",vt),et.subjectNameInput.addEventListener("keydown",t=>{"Enter"===t.key&&Mt(),"Escape"===t.key&&yt()}),et.subjectSaveBtn.addEventListener("click",Mt),et.subjectDeleteBtn.addEventListener("click",async()=>{const t=bt,e=await xt("과목 삭제","이 과목을 삭제할까요? (기록은 남지만 과목 목록에서 제거됨)");var n;jt(!1),e&&(n=t,s.store.subjects=s.store.subjects.filter(t=>t.id!==n),s.runtime.activeSubjectId===n&&at(""),s.store.settings.lastSubjectId===n&&(s.store.settings.lastSubjectId=""),s.save(),Bt(),yt())}),et.dayDetailModal.addEventListener("click",t=>{b(et.dayDetailModal,t)&&wt()}),et.dayDetailCloseBtn.addEventListener("click",wt),et.confirmCancelBtn.addEventListener("click",()=>jt(!1)),et.confirmOkBtn.addEventListener("click",()=>jt(!0));const mt=["#90caf9","#a5d6a7","#f48fb1","#ffcc80","#ce93d8","#80cbc4","#fff59d","#b0bec5"];let gt="add",bt="";function pt(t="add",e=""){if(gt=t,bt=e||"",et.subjectModal.showModal(),et.colorDots.innerHTML="",mt.forEach(t=>{const e=document.createElement("button");e.type="button",e.className="cdot",e.style.background=t,e.addEventListener("click",()=>{et.subjectColorInput.value=t,vt()}),et.colorDots.appendChild(e)}),"add"===t)et.subjectModalTitle.textContent="과목 추가",et.subjectModalDesc.textContent="과목명과 색상을 정하면 과목별 누적 시간이 자동 기록됩니다.",et.subjectNameInput.value="",et.subjectColorInput.value="#90caf9",et.subjectDeleteBtn.style.display="none";else{const t=y(e);et.subjectModalTitle.textContent="과목 수정",et.subjectModalDesc.textContent="이름/색상을 바꿔도 누적 기록은 유지됩니다.",et.subjectNameInput.value=t?t.name:"",et.subjectColorInput.value=t?.color||"#90caf9",et.subjectDeleteBtn.style.display="inline-flex"}vt(),setTimeout(()=>et.subjectNameInput.focus(),0)}function yt(){et.subjectModal.close(),bt=""}function vt(){const t=(et.subjectColorInput.value||"").toLowerCase();[...et.colorDots.children].forEach(e=>{const n=(e.style.background||"").toLowerCase();e.classList.toggle("active",w.equals(n,t))})}function Mt(){const t=(et.subjectNameInput.value||"").trim(),e=(et.subjectColorInput.value||"#90caf9").trim();if(t&&!s.store.subjects.some(e=>e.name.toLowerCase()===t.toLowerCase()&&e.id!==bt)){if("add"===gt){const n=function(t="id"){return`${t}_${Math.random().toString(16).slice(2)}_${Date.now().toString(16)}`}("s");s.store.subjects.push({id:n,name:t,color:e,createdAt:Date.now()}),at(n)}else{const n=y(bt);n&&(n.name=t,n.color=e)}s.save(),Bt(),yt()}}function kt(t){const e=p(t);et.dayDetailTitle.textContent=t,et.dayDetailSub.textContent=`총 ${u(e.totalMs||0)}`;const n=[];for(const[t,a]of Object.entries(e.subjects||{}))a&&n.push({sid:t,ms:a});if(n.sort((t,e)=>e.ms-t.ms),et.dayDetailList.innerHTML="",0===n.length){const t=document.createElement("div");t.className="item",t.innerHTML='<div class="item-row"><div class="item-name">기록 없음</div><div class="item-time">00:00:00</div></div>',et.dayDetailList.appendChild(t)}else{const t=Math.max(1,e.totalMs||0);n.forEach(e=>{const n=Math.min(100,e.ms/t*100),a=document.createElement("div"),s=e.sid?y(e.sid):void 0;let o=l(void 0!==s?s?.name??"삭제된 과목":"미분류"),r=s?.color??"rgba(255,255,255,0.28)";a.className="item",a.innerHTML=`\n\t\t\t\t<div class="item-row">\n\t\t\t\t\t<div class="item-name" title="${o}">\n\t\t\t\t\t\t<span style="display:inline-flex; align-items:center; gap:8px; min-width:0;">\n\t\t\t\t\t\t\t<span class="swatch" style="width:10px;height:10px; background:${r};"></span>\n\t\t\t\t\t\t\t<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:240px;">${o}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="item-time">${u(e.ms)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bar"><div style="width:${n.toFixed(1)}%; background:${r};"></div></div>\n\t\t\t`,et.dayDetailList.appendChild(a)})}et.dayDetailModal.showModal()}function wt(){et.dayDetailModal.close()}let St=null;function xt(t,e){return et.confirmTitle.textContent=t||"확인",et.confirmText.textContent=e||"",et.confirmModal.showModal(),new Promise(t=>{St=t})}function jt(t=!1){et.confirmModal.close(),St&&St(t),St=null}function Tt(t){const e=s.store.days[t];return e&&e.totalMs||0}function _t(){et.subjectSelect.innerHTML='<option value="">미분류</option>',s.store.subjects.forEach(t=>{const e=document.createElement("option");e.value=t.id,e.textContent=t.name,et.subjectSelect.appendChild(e)});const t=s.runtime.activeSubjectId||"";et.subjectSelect.value=t,et.subjectChips.innerHTML="";const e=document.createElement("button");e.type="button",e.className="chip"+(""===t?" active":""),e.innerHTML='<span class="dot" style="background: rgba(255,255,255,0.22)"></span><span>미분류</span>',e.addEventListener("click",()=>{at(""),s.runtime.running||ot()}),et.subjectChips.appendChild(e),s.store.subjects.forEach(e=>{const n=document.createElement("button");n.type="button",n.className="chip"+(e.id===t?" active":""),n.innerHTML=`<span class="dot" style="background:${e.color}"></span><span>${l(e.name)}</span>`,n.addEventListener("click",()=>{at(e.id),s.runtime.running||ot()}),et.subjectChips.appendChild(n)}),st();const n=s.store.settings.viewMode||"total";et.subjectSelect.disabled="subject"!==n}function Ct(){const t=Date.now(),e=p(d(t)),n=s.store.settings.dailyGoalMs||0,a=(e.totalMs||0)+(s.runtime.running&&s.runtime.lastTs?t-s.runtime.lastTs:0),o=(e.subjects?.[s.runtime.activeSubjectId||""]||0)+(s.runtime.running&&s.runtime.lastTs?t-s.runtime.lastTs:0),r=s.store.settings.viewMode||"total";if(et.studyTime.textContent=u("total"===r?a:o),n>0){const t=c(a/n*100,0,100);et.goalBarFill.style.width=`${t}%`,et.goalProgressBar.style.width=`${t}%`,et.goalProgressText.textContent=`${Math.floor(t)}% · ${u(a)} / ${u(n)}`,et.kpiTodaySub.textContent=`목표 ${u(n)} · ${Math.min(100,Math.floor(a/n*100))}%`,a>=n?et.studyHud.classList.add("goal-hit"):et.studyHud.classList.remove("goal-hit")}else et.goalBarFill.style.width="0%",et.goalProgressBar.style.width="0%",et.goalProgressText.textContent="목표 없음",et.studyHud.classList.remove("goal-hit");et.goalNow.textContent=n>0?u(n):"목표 없음"}function Et(){switch(et.panelSubtitle.textContent=`${d()} · 오프라인`,s.store.settings.panelTab){case"stats":!function(){const t=s.store.settings.statsPeriod||"today";et.periodTodayBtn.classList.toggle("active","today"===t),et.periodWeekBtn.classList.toggle("active","week"===t),et.periodMonthBtn.classList.toggle("active","month"===t);const e=Lt("today"),n=Lt("week"),a=Lt("month"),o=s.store.settings.dailyGoalMs||0;et.kpiToday.textContent=u(e.totalMs),et.kpiTodaySub.textContent=o>0?`목표 ${u(o)} · ${Math.min(100,Math.floor(e.totalMs/o*100))}%`:"목표 없음",et.kpiWeek.textContent=u(n.totalMs),et.kpiWeekSub.textContent=`평균 ${u(n.avgAllMs)}`,et.kpiMonth.textContent=u(a.totalMs),et.kpiMonthSub.textContent=`평균 ${u(a.avgAllMs)}`;const r=s.store.meta.bestFocusMs||0,i=n.longestFocusMs||0;et.focusInfo.textContent=`최장 집중 ${u(Math.max(i,r))}`;const c=Lt(s.store.settings.statsPeriod||"today"),h=c.totalMs||0,f=[];s.store.subjects.forEach(t=>{const e=c.perSubject[t.id]||0;f.push({id:t.id,name:t.name,ms:e,color:t.color,exists:!0})});for(const t of Object.keys(c.perSubject))if(""!==t&&!s.store.subjects.some(e=>e.id===t)){const e=c.perSubject[t]||0;e>0&&f.push({id:t,name:"삭제된 과목",ms:e,color:"rgba(255,255,255,0.25)",exists:!1})}const m=c.perSubject[""]||0;if(m>0&&f.push({id:"",name:"미분류",ms:m,color:"rgba(255,255,255,0.22)",exists:!0}),f.sort((t,e)=>e.ms-t.ms),et.breakdownList.innerHTML="",f.every(t=>t.ms<=0)){const t=document.createElement("div");return t.className="item",t.innerHTML='<div class="item-row"><div class="item-name">기록이 없어요</div><div class="item-time">00:00:00</div></div>',void et.breakdownList.appendChild(t)}f.forEach(t=>{if(t.ms<=0)return;const e=h>0?Math.min(100,t.ms/h*100):0,n=document.createElement("div");n.className="item",n.innerHTML=`\n\t\t\t<div class="item-row">\n\t\t\t\t<div class="item-name" title="${l(t.name)}">\n\t\t\t\t\t<span style="display:inline-flex; align-items:center; gap:8px; min-width:0;">\n\t\t\t\t\t\t<span class="swatch" style="width:10px;height:10px; background:${t.color};"></span>\n\t\t\t\t\t\t<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:220px;">${l(t.name)}</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="item-time">${u(t.ms)}</div>\n\t\t\t</div>\n\t\t\t<div class="bar"><div style="width:${e.toFixed(1)}%; background:${t.color};"></div></div>\n\t\t`,et.breakdownList.appendChild(n)});const b=g(Date.now()),p=Array.from({length:7},(t,e)=>Tt(d(b+864e5*e))),y=Math.max(1,...p);et.weekdayBars.innerHTML="",["월","화","수","목","금","토","일"].forEach((t,e)=>{const n=p[e],a=Math.round(n/y*100),s=document.createElement("div");s.className="week-bar"+(n<=0?" zero":""),s.innerHTML=`\n\t\t\t<div class="barcol"><div style="height:${a}%"></div></div>\n\t\t\t<div class="wlabel">${t}</div>\n\t\t`,et.weekdayBars.appendChild(s)})}();break;case"calendar":!function(){if(!et.calDow.dataset.built){const t=["M","T","W","T","F","S","S"];et.calDow.innerHTML="",t.forEach(t=>{const e=document.createElement("div");e.className="cal-dow",e.textContent=t,et.calDow.appendChild(e)}),et.calDow.dataset.built="1"}const t=s.store.settings.calendarMonthTs||f(Date.now()),e=new Date(t),n=e.getFullYear(),a=e.getMonth();et.calTitle.textContent=`${n}-${i(a+1)}`;const o=new Date(n,a,1).getDay(),r=0===o?6:o-1,c=new Date(n,a+1,0).getDate();et.calGrid.innerHTML="";const l=7*Math.ceil((r+c)/7),h=d();for(let t=0;t<l;t++){const e=t-r+1;if(e<1||e>c){const t=document.createElement("div");t.style.opacity="0",et.calGrid.appendChild(t);continue}const s=new Date(n,a,e);s.setHours(0,0,0,0);const o=d(s.getTime()),i=Tt(o),l=document.createElement("button");l.type="button",l.className="cal-day"+(i<=0?" off":"")+(o===h?" today":""),l.innerHTML=`\n\t\t\t<div class="dnum">${e}</div>\n\t\t\t<div class="dtime">${i>0?u(i):""}</div>\n\t\t`,(i>0||o===h)&&l.addEventListener("click",()=>kt(o)),et.calGrid.appendChild(l)}}();break;case"subjects":!function(){if(et.subjectsManageList.innerHTML="",0===s.store.subjects.length){const t=document.createElement("div");return t.className="item",t.innerHTML='<div class="item-row"><div class="item-name">과목이 없어요</div><div class="item-time">^v^</div></div>',void et.subjectsManageList.appendChild(t)}s.store.subjects.slice().sort((t,e)=>(t.createdAt||0)-(e.createdAt||0)).forEach(t=>{let e=0;for(const n of Object.keys(s.store.days)){const a=s.store.days[n];e+=a.subjects?.[t.id]||0}const n=document.createElement("div");n.className="msub",n.innerHTML=`\n\t\t\t\t<div class="item-row">\n\t\t\t\t\t<span class="swatch" style="background:${t.color}"></span>\n\t\t\t\t\t<div class="msub-name" title="${l(t.name)}">${l(t.name)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="item-row">\n\t\t\t\t\t<div class="msub-time">${u(e)}</div>\n\t\t\t\t\t<button class="icon-btn" aria-label="Edit" style="width:34px;height:34px;border-radius:14px;">\n\t\t\t\t\t\t<svg width="16" height="16" viewBox="0 0 24 24" fill="none">\n\t\t\t\t\t\t\t<path d="M4 20H8L18.5 9.5C19.3 8.7 19.3 7.4 18.5 6.6L17.4 5.5C16.6 4.7 15.3 4.7 14.5 5.5L4 16V20Z"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`,n.querySelector('button[aria-label="Edit"]').addEventListener("click",()=>pt("edit",t.id)),et.subjectsManageList.appendChild(n)})}();break;case"goal":!function(){const t=s.store.settings.dailyGoalMs||0;et.goalHours.value=Math.floor(t/36e5),et.goalMinutes.value=Math.floor(t%36e5/6e4),et.goalNow.textContent=t>0?u(t):"목표 없음"}()}}function Lt(t){const e=Date.now();let n,a;if("today"===t){const t=d();n=[t],a=t}else if("week"===t){const t=g(e);n=Array.from({length:7},(e,n)=>d(t+864e5*n)),a=`${n[0]} ~ ${n[6]}`}else{const t=f(e),s=function(t){const e=new Date(t);return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}(e);n=Array.from({length:s},(e,n)=>d(t+864e5*n));const o=new Date(t);a=`${o.getFullYear()}-${i(o.getMonth()+1)}`}const o={};let r=0,c=0,l=0;n.forEach(t=>{const e=s.store.days[t],n=e?.totalMs||0;if(r+=n,n>0&&(c+=1),l=Math.max(l,e?.longestFocusMs||0),e?.subjects)for(const[t,n]of Object.entries(e.subjects))o[t]=(o[t]||0)+(n||0)});const u=n.length,h=r/Math.max(1,u);return{period:t,label:a,keys:n,totalMs:r,perSubject:o,longestFocusMs:l,avgAllMs:h,studiedDays:c}}function Bt(){_t(),Ct(),Et()}function $t(t){const e=s.runtime;t:{if(!e.running||!e.lastTs)break t;if(t<=e.lastTs)break t;const n=e.activeSubjectId||"";let a=e.lastTs;for(;a<t;){const e=d(a),s=m(a),o=Math.min(t,s),r=o-a,i=p(e);i.totalMs+=r,i.subjects[n]||(i.subjects[n]=0),i.subjects[n]+=r,a=o}e.lastTs=t}if(!e.running||!e.sessionStartTs)return;if(d(e.sessionStartTs)===d(t))return;const n=e.sessionSubjectId||"";At(t),e.sessionStartTs=h(t),e.sessionSubjectId=n}function At(t){const e=s.runtime;if(!e.sessionStartTs)return;const n=e.sessionStartTs,a=e.sessionSubjectId||"";if(e.sessionStartTs=0,e.sessionSubjectId="",t<=n)return;let o=n;for(;o<t;){const e=d(o),n=m(o),s=Math.min(t,n);p(e).sessions.push({start:o,end:s,sid:a}),o=s}}document.addEventListener("visibilitychange",()=>{if(!document.hidden){const t=Date.now();s.runtime.running&&($t(t),s.save()),Bt()}}),s.runtime.activeSubjectId=s.store.settings.lastSubjectId||"",Bt(),function(){if(s.runtime.rafId)return;const t=()=>{s.runtime.rafId=requestAnimationFrame(t);const e=Date.now();s.runtime.running&&($t(e),e-(s.runtime.lastSaveTs||0)>2e3&&(s.runtime.lastSaveTs=e,s.save())),e-(s.runtime.lastUiTs||0)>500&&(s.runtime.lastUiTs=e,Ct()),s.runtime.running&&s.runtime.panelOpen&&e-(s.runtime.lastUiPanelTs||0)>500&&(s.runtime.lastUiPanelTs=e,Et())};s.runtime.rafId=requestAnimationFrame(t)}(),async function(){const t=Object.keys(s.store.days),e=d(Date.now());for(const n of t)if(n<e&&"true"!==localStorage.getItem(`synced_${n}`)){const t=new Date(n).getTime();await r(t)}setInterval(()=>{const t=new Date;if(0===t.getHours()&&0===t.getMinutes()){const t=Date.now()-12e4,e=d(t);"true"!==localStorage.getItem(`synced_${e}`)&&r(t)}},6e4)}(),function(){console.log("테스트 설정: 21시 0분");const t=setInterval(()=>{const e=new Date,n=e.getHours(),a=e.getMinutes();21===n&&0===a&&(console.log("완"),r(Date.now()),clearInterval(t))},1e4)}()})()})();