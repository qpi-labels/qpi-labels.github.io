<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>기준타</title>
    <meta name="description" content="기쁨을 준비하는 타이머">
    <meta property="og:title" content="기준타 by QPI">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/project/basetimer/img/btog.png">
    <!-- 위를 다음으로 교체: <meta property="og:image" content="/project/basetimer_dist/img/btog.png"> -->
    <meta property="og:description" content="기쁨을 준비하는 타이머">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="img/apple-icon.png">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="img/icon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <link rel="stylesheet" href="style/ambient.css">
    <link rel="stylesheet" href="style/timer.css" media="print" onload="this.media='all'">
    <!-- 위를 다음으로 교체: <link rel="stylesheet" href="style.css"> -->

    <script src="js/ambient.js" type="text/javascript" defer></script>
    <script src="js/timer.js" type="module"></script>
    <!-- 위를 다음으로 교체: <script src="main.js" type="module"></script> -->
</head>
<body>
    <div class="layer sky-base"></div>
    <div id="skyLayer" class="layer sky-layer"></div>
    <div class="layer atmosphere"></div>
    <div class="layer star-container"><canvas id="starCanvas"></canvas></div>
    <div id="satLayer" class="layer"></div>
    <div class="layer celestial"><div class="moon-aura"></div><div class="moon-disk"></div><div class="sun-disk"></div></div>

    <div class="flare-container" id="sunFlareCont">
        <div class="sun-streak"></div>
        <div class="flare-ghost flare-halo" id="h-1" style="width: 60vmax; height: 60vmax;"></div>
        <div class="flare-ghost ghost-rainbow" id="r-1" style="width: 500px; height: 500px;"></div>
        <div class="flare-ghost ghost-hex" id="g-1" style="width: 100px; height: 100px;"></div>
        <div class="flare-ghost ghost-hex" id="g-2" style="width: 50px; height: 50px; background: rgba(150, 255, 200, 0.12);"></div>
        <div class="flare-ghost ghost-tiny" id="t-1"></div>
    </div>

    <div class="flare-container" id="moonFlareCont">
        <div class="flare-ghost ghost-hex" id="mg-1" style="width: 40px; height: 40px; background: rgba(200, 230, 255, 0.1);"></div>
        <div class="flare-ghost flare-halo" id="mh-1" style="width: 20vmax; height: 20vmax; opacity: 0.2;"></div>
    </div>

    <div class="glass-panel-base study-hud" id="studyHud">
        <div class="flex-row" id="study-row1">
            <div class="study-time" id="studyTime">00:00:00</div>
            <div class="study-mini">
                <button class="icon-btn" id="openPanelBtn" aria-label="Stats">
                    <svg width="18" height="18" viewBox="0 0 24 24"><path d="M4 19V10"/><path d="M10 19V5"/><path d="M16 19V13"/><path d="M22 19H2"/></svg>
                </button>
                <button class="icon-btn" id="addSubjectBtn" aria-label="Add Subject">
                    <svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 5V19"/><path d="M5 12H19"/></svg>
                </button>
            </div>
        </div>

        <div class="goalbar"><div id="goalBarFill"></div></div>

        <div class="flex-row margin">
            <div class="segmented" aria-label="Timer View Mode">
                <button class="seg-btn active" id="modeTotalBtn" type="button">오늘 총 공부</button>
                <button class="seg-btn" id="modeSubjectBtn" type="button">과목</button>
            </div>
            <div class="select-wrapper">
                <select class="study-select" id="subjectSelect" aria-label="Subject Select" disabled>
                    <option value="">과목 선택</option>
                </select>
                <svg class="select-arrow" height="24" viewBox="0 0 24 24" width="24"><path d="M4 10l4 4 4-4"/></svg>
            </div>
        </div>

        <div class="flex-row margin">
            <div class="chipbar" id="subjectChips" aria-label="Subject Buttons"></div>
            <button class="study-toggle" id="studyToggleBtn" type="button" aria-label="Start/Pause">
                <svg id="studyToggleIcon" width="16" height="16" viewBox="0 0 24 24"><path d="M8 5V19L19 12L8 5Z"/></svg>
                <span id="studyToggleText">START</span>
            </button>
        </div>
        <div class="sheet" id="panelSheet">
            <hr id="panelHR">
            <div class="flex-row">
                <div>
                    <div class="sheet-title" id="panelTitle">통계</div>
                    <div class="sheet-sub" id="panelSubtitle">—</div>
                </div>
                <button class="icon-btn" id="closePanelBtn" aria-label="Close Panel">
                    <svg width="18" height="18" viewBox="0 0 24 24"><path d="M6 6L18 18"/><path d="M18 6L6 18"/></svg>
                </button>
            </div>
            <div class="segmented panel-tabs" role="tablist" aria-label="Panels">
                <button class="seg-btn flex-fill active" id="tabBtnStats" type="button" role="tab">통계</button>
                <button class="seg-btn flex-fill" id="tabBtnCalendar" type="button" role="tab">캘린더</button>
                <button class="seg-btn flex-fill" id="tabBtnSubjects" type="button" role="tab">과목</button>
                <button class="seg-btn flex-fill" id="tabBtnGoal" type="button" role="tab">목표</button>
            </div>

            <div class="sheet-scroll" id="panelScroll">
            <section class="tab active" id="tabStats" role="tabpanel">
                <div class="flex-row">
                    <div class="kpi">
                        <div class="kpi-label">오늘</div>
                        <div class="kpi-value" id="kpiToday">00:00:00</div>
                        <div class="kpi-sub" id="kpiTodaySub">목표 —</div>
                    </div>
                    <div class="kpi">
                        <div class="kpi-label">이번 주</div>
                        <div class="kpi-value" id="kpiWeek">00:00:00</div>
                        <div class="kpi-sub" id="kpiWeekSub">평균 —</div>
                    </div>
                    <div class="kpi">
                        <div class="kpi-label">이번 달</div>
                        <div class="kpi-value" id="kpiMonth">00:00:00</div>
                        <div class="kpi-sub" id="kpiMonthSub">평균 —</div>
                    </div>
                </div>

                <div class="flex-row period-row">
                    <div class="segmented" role="tablist" aria-label="Stats Period">
                        <button class="seg-btn active" id="periodTodayBtn" type="button" role="tab">오늘</button>
                        <button class="seg-btn" id="periodWeekBtn" type="button" role="tab">주</button>
                        <button class="seg-btn" id="periodMonthBtn" type="button" role="tab">달</button>
                    </div>
                    <button class="modal-btn" id="exportBtn" type="button">내보내기</button>
                </div>

                <div class="list" id="breakdownList"></div>

                <div class="weekday">
                    <div class="flex-row">
                        <div class="item-name">요일별 공부량 (이번 주)</div>
                        <div class="item-time" id="focusInfo">최장 집중 —</div>
                    </div>
                    <div class="week-bars" id="weekdayBars"></div>
                </div>

                <div class="sheet-actions">
                    <button class="modal-btn danger" id="resetTodayBtn" type="button">오늘 초기화</button>
                    <button class="modal-btn danger" id="resetAllBtn" type="button">전체 초기화</button>
                </div>
            </section>

            <section class="tab" id="tabCalendar" role="tabpanel">
                <div class="calendar">
                    <div class="flex-row cal-header">
                        <button class="icon-btn" id="calPrevBtn" aria-label="Prev Month">
                            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M15 6L9 12L15 18"/></svg>
                        </button>
                        <div class="cal-title" id="calTitle">—</div>
                        <button class="icon-btn" id="calNextBtn" aria-label="Next Month">
                            <svg width="18" height="18" viewBox="0 0 24 24"><path d="M9 6L15 12L9 18"/></svg>
                        </button>
                    </div>
                    <div class="cal-grid" id="calDow"></div>
                    <div class="cal-grid" id="calGrid"></div>
                </div>
            </section>

            <section class="tab" id="tabSubjects" role="tabpanel">
                <div class="item flex-row">
                    <div>
                        <div class="item-name">과목 관리</div>
                        <div class="sheet-sub">추가/수정/삭제 · 색상 설정</div>
                    </div>
                    <button class="icon-btn" id="addSubjectBtn2" aria-label="Add Subject">
                        <svg width="18" height="18" viewBox="0 0 24 24"><path d="M12 5V19"/><path d="M5 12H19"/></svg>
                    </button>
                </div>
                <div class="list" id="subjectsManageList"></div>
            </section>

            <section class="tab" id="tabGoal" role="tabpanel">
                <div class="item">
                    <div class="flex-row">
                        <div class="item-name">하루 목표 공부 시간</div>
                        <div class="item-time" id="goalNow">—</div>
                    </div>
                    <div class="flex-row margin">
                        <input id="goalHours" class="goalinput" type="number" min="0" max="23" value="2">
                        <input id="goalMinutes" class="goalinput" type="number" min="0" max="59" value="0">
                    </div>
                    <div class="sheet-sub margin">시간(왼쪽) · 분(오른쪽)</div>
                    <div class="flex-row margin">
                        <div class="flex-fill"></div>
                        <button class="modal-btn" id="goalResetBtn" type="button">기본값</button>
                        <button class="modal-btn primary" id="goalSaveBtn" type="button">저장</button>
                    </div>
                </div>
                <div class="item margin">
                    <div class="flex-row">
                        <div class="item-name">오늘 달성률</div>
                        <div class="item-time" id="goalProgressText">—</div>
                    </div>
                    <div class="bar margin"><div id="goalProgressBar"></div></div>
                </div>
            </section>
            </div>
        </div>
    </div>

    <!-- Subject Modal -->
    <dialog id="subjectModal" class="glass-panel-base modal" aria-labelledby="subjectModalTitle">
        <h3 id="subjectModalTitle">과목</h3>
        <p id="subjectModalDesc">과목을 추가/수정하면 과목별 누적 시간이 자동 기록됩니다.</p>
        <input id="subjectNameInput" type="text" placeholder="예) 수학, 물리, 영어" maxlength="24">
        <div class="flex-row margin">
            <div class="colors" id="colorDots" aria-label="Color Presets"></div>
            <input class="color-input" id="subjectColorInput" type="color" value="#90caf9" aria-label="Custom Color">
        </div>
        <div class="flex-row margin">
            <button class="modal-btn danger" id="subjectDeleteBtn" type="button">삭제</button>
            <div class="flex-fill"></div>
            <button class="modal-btn" id="subjectCancelBtn" type="button">취소</button>
            <button class="modal-btn primary" id="subjectSaveBtn" type="button">저장</button>
        </div>
    </dialog>

    <!-- Day Detail Modal -->
    <dialog id="dayDetailModal" class="glass-panel-base modal" aria-labelledby="dayDetailTitle">
        <h3 id="dayDetailTitle">—</h3>
        <p id="dayDetailSub">—</p>
        <div class="list" id="dayDetailList"></div>
        <div class="flex-row margin">
            <div class="flex-fill"></div>
            <button class="modal-btn" id="dayDetailCloseBtn" type="button">닫기</button>
        </div>
    </dialog>

    <!-- Confirm Modal -->
    <dialog id="confirmModal" class="glass-panel-base modal" aria-labelledby="confirmTitle">
        <h3 id="confirmTitle">확인</h3>
        <p id="confirmText">—</p>
        <div class="flex-row margin">
            <div class="flex-fill"></div>
            <button class="modal-btn" id="confirmCancelBtn" type="button">취소</button>
            <button class="modal-btn danger" id="confirmOkBtn" type="button">확인</button>
        </div>
    </dialog>

    <button class="glass-panel-base bottom-clock" id="clock" popovertarget="infoPanel" aria-label="Time Settings"><span id="clockT">00:00:00</span></button>
    <dialog popover="auto" class="info-panel glass-panel-base" id="infoPanel">
        <div class="row"><span><b>DATE</b> <span id="infoDate">-</span></span></div>
        <div class="row"><span class="label"><b>RISE</b> <span id="infoRise">-</span></span><span class="label"><b>SET</b> <span id="infoSet">-</span></span></div>
        <hr>
        <div class="row"><span class="label">Auto Sync</span><label class="switch"><input type="checkbox" id="autoCheck" checked></label></div>
        <div id="manualSection" class="manual-ui disabled">
            <div class="row slider-row secret"><span class="label">Multiverse</span><input type="range" id="multiverseRange" min="-180" max="179.99" step="0.01" value="0" disabled></div>
            <div class="row slider-row"><span class="label">Time Slider</span><input type="range" id="timeRange" min="0" max="1439.99" step="0.01" value="720" disabled></div>
            <div class="row"><span class="label">Speed (<span id="speedVal">1</span>x)</span><div class="speed-chips"><button class="oldchip" id="manualSlower" disabled>x0.5</button><button class="oldchip" id="manualFaster" disabled>x2</button><button class="oldchip" id="manualReverse" disabled>x-1</button></div></div>
        </div>
    </dialog>
    
    <button class="fab glass-panel-base" popovertarget="popup" aria-label="Ambience Settings"><svg class="fab-icon" viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 018.5 12 3.5 3.5 0 0112 8.5 3.5 3.5 0 0115.5 12 3.5 3.5 0 0112 15.5M19.43 12.97C19.47 12.65 19.5 12.33 19.5 12 19.5 11.67 19.47 11.34 19.43 11.03L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.05L16.56 6.05C16.04 5.66 15.47 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.53 5.32 7.96 5.66 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11.03C4.53 11.34 4.5 12 4.57 11.03 4.5 12.33 4.53 12.65 4.57 12.97L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.94C7.96 18.34 8.53 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.47 18.67 16.04 18.34 16.56 17.94L19.05 18.95C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.97Z"></svg></button>
    <dialog popover="auto" class="popup glass-panel-base" id="popup">
        <div class="row"><span class="label">Performance Mode</span><label class="switch"><input type="checkbox" id="perfToggle"></label></div>
        <hr>
        <div class="row"><span class="label">Ambient Night</span><label class="switch"><input type="checkbox" class="soundToggle" value="0"></label></div>
        <div class="row"><span class="label">Ambient Dark</span><label class="switch"><input type="checkbox" class="soundToggle" value="1"></label></div>
        <div class="row secret"><span class="label">Ambient Ambient</span><label class="switch"><input type="checkbox" class="soundToggle" value="2"></label></div>
        <div class="row slider-row"><span class="label">Volume</span><input type="range" id="volumeRange" min="0" max="100" step="1" value="50"></div>
        <button class="btn-action" id="btnViz">ENABLE VISUALIZER</button>
    </dialog>
    <canvas id="vizCanvas" class="viz-canvas"></canvas>
</body>
</html>
